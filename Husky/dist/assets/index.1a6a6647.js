var b=Object.defineProperty;var M=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var N=(n,e,t)=>e in n?b(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e)=>{for(var t in e||(e={}))A.call(e,t)&&N(n,t,e[t]);if(M)for(var t of M(e))P.call(e,t)&&N(n,t,e[t]);return n};var y=(n,e,t)=>(N(n,typeof e!="symbol"?e+"":e,t),t);const E=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}};E();const m={token:"CWB-34AC2BFB-2272-41E3-84FE-AAF40C0C42AA",host:"https://opendata.cwb.gov.tw",datastore:{weather:{apiPath:"api/v1/rest/datastore/O-A0003-001",elementName:["TIME","ELEV","WDIR","WDSD","TEMP","HUMD","PRES","24R","H_FX","H_XD","H_FXT","H_F10","H_10D","H_F10T","H_UVI","D_TX","D_TXT","D_TN","D_TNT","D_TS","VIS","Weather"],noData:-99},precipitation:{apiPath:"api/v1/rest/datastore/O-A0002-001",elementName:["ELEV","RAIN","MIN_10","HOUR_3","HOUR_6","HOUR_12","HOUR_24","NOW"],noData:-999},forecast:{apiPath:"api/v1/rest/datastore/F-D0047-089",elementName:["Wx","PoP12h","AT","T","RH","CI","WeatherDescription","PoP6h","WS","WD","Td"]}}};class ${async fetch(e,t){let o=new URLSearchParams(t);return await(await fetch(`${this.host}/${e}?${o.toString()}`)).json()}}const C=n=>(n.weather=n.weatherElement.reduce((e,t)=>(e[t.elementName]=Number(t.elementValue),e),{}),n.parameter=n.parameter.reduce((e,t)=>(e[t.parameterName]=t.parameterValue,e),{}),n.obsTime=n.time.obsTime,n.lat=Number(n.lat),n.lon=Number(n.lon),delete n.time,delete n.weatherElement,n),F=n=>n.records.location.map(C),I=(n,e)=>n.records.locations[0].location.find(t=>t.locationName===e).weatherElement;class f extends ${constructor(){super();this.token=m.token,this.host=m.host}async getCurrent(e=[],t="weather"){const{apiPath:o,elementName:a}=m.datastore[t];e=a.filter(l=>e.includes(l));const r={elementName:e.join(","),parameterName:"CITY,TOWN",Authorization:this.token},c=await this.fetch(o,r);return F(c)}async getForecast(e=[],t="\u81FA\u5317\u5E02"){const o="forecast",{apiPath:a,elementName:r}=m.datastore[o];e=r.filter(s=>e.includes(s));const c={elementName:e.join(","),locationName:t,Authorization:this.token},l=await this.fetch(a,c);return I(l,t)}}const T=class{static chain(e){return T.queue=T.queue.then(e)}};let g=T;y(g,"queue",Promise.resolve());const u={MIN:n=>(e,t)=>n(t)<n(e)?t:e,MAX:n=>(e,t)=>n(t)<n(e)?e:t,BOTTOM:n=>(e,t)=>n(e)<n(t)?-1:1,TOP:n=>(e,t)=>n(e)<n(t)?1:-1};class d extends g{constructor(e,t){super();this.title=e,this.answer=null,this.calcFn=t}static createSection(e,t){const o=document.createElement("section");o.classList.add("bg-white","text-black","text-opacity-70","rounded-2xl","shadow-xl","p-8");const a=document.createElement("h6");if(a.classList.add("text-md","font-black"),a.innerHTML=e.trim(),o.appendChild(a),t){const r=document.createElement("textarea");r.disabled=!0,r.classList.add("w-full","p-4","text-black","text-opacity-70","text-sm"),r.value=t,r.rows=t.split(`
`).length,o.appendChild(r)}return o}getAnswer(e){return d.chain(async()=>{this.answer=await this.calcFn(e)}),this}output(e){return d.chain(async()=>{if(this.answer==null||this.title==null)throw"no answer";const t=JSON.stringify(this.answer,null,"    "),o=d.createSection(this.title),a=d.createSection("Answer\uFF1A",t),r=document.createElement("div");r.classList.add("space-y-6"),r.appendChild(o),r.appendChild(a),e.appendChild(r)}),this}}const{datastore:{weather:{noData:x}}}=m,H=new f,R="\u7B2C\u4E00\u984C\uFF1A\u627E\u5230\u5168\u53F0\u7576\u4E0B\u6700\u4F4E\u6EAB\u7684\u9EDE\uFF0C\u4E26\u5217\u51FA \u7E23\u5E02 \u884C\u653F\u5340 \u6E2C\u7AD9\u540D\u7A31 \u6EAB\u5EA6 \u5EA7\u6A19",S=async(n={field:"TEMP",calc:"MIN"})=>{const{field:e,calc:t}=n,o=r=>r.weather[e];return(await H.getCurrent([e],"weather")).filter(r=>o(r)!==x).reduce(u[t](o))},v=new d(R,S),{datastore:{weather:{noData:L}}}=m,O="ELEV",k=new f,D=n=>("0000"+n).slice(-4),W=n=>Object.entries(n).map(([e,t])=>({elevRange:e,site:t})).sort(u.BOTTOM(e=>e.elevRange)),_="\u7B2C\u4E8C\u984C\uFF1A\u540C\u4E0A\uFF0C\u91DD\u5C0D\u4E0D\u540C\u6D77\u62D4\u9AD8\u5EA6\u627E\u51FA\u6700\u4F4E\u6EAB\u6E2C\u7AD9\uFF0C\u6BCF500m\u4E00\u7D44\uFF0C\u4E26\u56DE\u50B3object",q=async(n={field:"TEMP",calc:"MIN",step:500})=>{const{field:e,calc:t,step:o}=n,a=s=>s.weather[e],r=s=>{const i=Math.floor(s.weather[O]/o)*o;return`${D(i)}-${D(i+o-1)}`},l=(await k.getCurrent([e,O],"weather")).filter(s=>a(s)!==L).reduce((s,i)=>{const h=r(i);return s[h]?s[h]=u[t](a)(s[h],i):s[h]=i,s},{});return W(l)},B=new d(_,q),{datastore:{precipitation:{noData:U}}}=m,V=new f,X="\u7B2C\u4E09\u984C\uFF1A\u8FD124\u5C0F\u6642\u964D\u96E8\u91CF\u524D20\u540D\u662F\u54EA\u4E9B\uFF1F\u5206\u5225\u7D71\u8A08\u6574\u7406\u5217\u5728\u54EA\u4E9B\u7E23\u5E02\uFF1F",j=async(n={field:"HOUR_24",calc:"TOP",rank:20})=>{const{field:e,calc:t,rank:o}=n,a=s=>s.weather[e],c=(await V.getCurrent([e],"precipitation")).filter(s=>a(s)!==U).sort(u[t](a)).slice(0,o),l=c.reduce((s,i)=>(s[i.parameter.CITY]==null&&(s[i.parameter.CITY]=0),s[i.parameter.CITY]+=1,s),{});return{top:c,stat:l}},Y=new d(X,j),z=n=>n.map(e=>e.time.map(t=>({dataTime:t.dataTime,weather:t.elementValue.reduce((o,a)=>(o[e.elementName]=Number(a.value),o),{})}))).reduce((e,t)=>(e.forEach((o,a)=>{o.weather=p(p({},o.weather),t[a].weather)}),e)),J=(n,e)=>Object.entries(n.reduce((t,o)=>{const a=o.dataTime.slice(0,10);return t[a]==null&&(t[a]=[]),t[a].push(e(o)),t},{})).sort(u.BOTTOM(t=>t[0])),K=n=>{n=n.sort();const e=n.slice(-1)[0],t=n.slice(0)[0];return{range:`${t}~${e}`,diff:e-t}},Z="\u7B2C\u56DB\u984C\uFF1A\u81EA\u5DF1\u6240\u5728\u7684\u7E23\u5E02\uFF0C\u672A\u4F86\u5169\u5929\u7684\u6700\u4F4E\u6EAB\u8207\u6700\u9AD8\u6EAB\u5206\u5225\u70BA\u591A\u5C11\uFF1F\u4E14\u6700\u5927\u55AE\u65E5\u6EAB\u5DEE\u70BA\u591A\u5C11\uFF1F",G=async(n={field:"T",locationName:"\u81FA\u5317\u5E02"})=>{const{field:e,locationName:t}=n;let a=await new f().getForecast([e],t);a=z(a);const r=c=>c.weather[e];return{min:a.reduce(u.MIN(r)),max:a.reduce(u.MAX(r)),maxDiff:J(a,r).map(([c,l])=>p({date:c},K(l))).reduce(u.MAX(c=>c.diff))}},Q=new d(Z,G),w=document.getElementById("app");v.getAnswer({field:"TEMP",calc:"MIN"}).output(w);B.getAnswer({field:"TEMP",calc:"MIN",step:500}).output(w);Y.getAnswer({field:"HOUR_24",calc:"TOP",rank:20}).output(w);Q.getAnswer({field:"T",locationName:"\u81FA\u5317\u5E02"}).output(w);
